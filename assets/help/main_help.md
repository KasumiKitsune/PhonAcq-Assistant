# 欢迎使用 PhonAcq Assistant

**PhonAcq Assistant (音韵习得实验助手)** 是一款专为语言学研究者、教师和学习者设计的集成化桌面应用程序。它致力于将繁琐的语音数据采集、语料构建、数据管理乃至后续的学习复习流程变得简单、高效和规范化。

本手册将详细介绍程序的各项功能和最佳实践，希望能帮助您快速上手并充分利用它的潜力。请使用左侧的目录来导航至您感兴趣的章节。

---

## 一、核心工作流程

本程序支持多种数据采集与学习范式，您可以根据研究或学习需求选择合适的流程。一个典型的研究工作流如下：

1.  **准备语料 (采集或学习前)**:
    *   **方法一 (推荐):** 前往 `语料管理 -> Excel 转换器`，下载并填写模板，然后将填写好的 `.xlsx` 文件转换为程序可用的 `.py` 词表文件。这是与不熟悉代码的协作者共享和编辑词表的最佳方式。
    *   **方法二 (直接编辑):** 
        *   **标准词表**: 前往 `语料管理 -> 词表编辑器` 直接创建或编辑用于“口音采集”的 `.py` 文件。
        *   **图文词表**: 前往 `方言研究 -> 图文词表编辑` 创建或编辑用于“图文采集”的 `.py` 文件。
2.  **生成提示音 (可选但推荐)**:
    *   **真人语音包**: 前往 `数据采集 -> 语音包录制`，为您的标准词表录制一套高质量的真人提示音。这是保证音质和一致性的最佳选择。
    *   **TTS批量生成**: 前往 `实用工具 -> TTS 工具`，加载您的词表，批量生成合成语音。您可以选择将其输出到速记卡模块的专用音频目录。
3.  **开始采集 (研究)**:
    *   **口音采集**: 前往 `数据采集 -> 口音采集会话`，进行标准的跟读实验。
    *   **方言图文采集**: 前往 `方言研究 -> 图文采集`，进行看图说话式的田野调查。
4.  **管理与编辑数据**:
    *   前往 `语料管理 -> 数据管理器`，在这里您可以浏览、试听、重命名、删除所有已录制的音频数据。更重要的是，您还可以使用内置的**波形编辑器**对音频进行**裁切**和**连接**。
    *   前往 `语料管理 -> 日志查看器`，审查每次采集会话的详细过程日志，或切换到“速记卡模式”分析学习进度。
5.  **开始学习 (复习)**:
    *   前往 `实用工具 -> 速记卡`，加载标准或图文词表，选择学习或自检模式，开始高效记忆。
6.  **程序设置**: 在 `系统与帮助 -> 程序设置` 中可以自定义程序行为，如主题、默认路径、音频参数（包括录音格式）、侧边栏宽度等。

<div class="tip">
<strong>提示音优先级</strong>: 在“口音采集会话”中，提示音的播放优先级为：<strong>真人语音包 (audio_record/) > TTS语音 (audio_tts/) > 在线实时生成</strong>。建议为核心实验语料录制真人语音包。
</div>

---

## 二、功能模块详解

### 数据采集
#### 口音采集会话
**路径**: `数据采集 -> 口音采集会话`

这是进行**文本到语音**实验的核心界面，适用于标准的朗读任务、最小音对测试、句子复述等场景。

*   **会话准备**: 您需要先选择一个 `.py` 格式的**标准词表**，并为被试者命名。系统会自动检查并生成缺失的TTS提示音，确保实验的顺利进行。
*   **范式控制**: 您可以通过“随机/顺序”和“部分/完整”开关，灵活设计实验范式，以减少顺序效应等实验偏差。
*   **无损录音**: 本模块采用**持久化音频流**技术，从会话开始便激活麦克风，彻底解决了因设备启动延迟而造成的音频开头数据丢失问题，确保语音信号的完整捕获。
*   **流程自动化**: 一次录制成功后，列表焦点会自动跳转到下一个未录制的词条。已录制的条目会有清晰的对勾标记，方便追踪进度和进行补录。
*   **数据追溯**: 每次会话都会在结果文件夹中生成一个 `log.txt` 文件，详细记录所有操作的时间戳，增强了实验数据的可追溯性和学术可信度。

#### 语音包录制
**路径**: `数据采集 -> 语音包录制`

此功能旨在让研究者能够**创建一套属于自己的、高质量、发音统一的真人提示音库**，以完全替代在线TTS服务。

*   **核心流程**: 加载标准词表，逐一选中词条，通过**按住并松开**“录音”按钮或 `Enter` 键来完成录制。新的录音会自动覆盖旧版，确保留下的总是最满意的一版。
*   **关键特性**: 同样采用持久化音频流确保无延迟录音。已完成的词条会以对勾图标标记，状态一目了然。录音格式会自动遵循全局设置（WAV/MP3）。

#### 方言图文采集
**路径**: `方言研究 -> 图文采集`

这是一个强大的功能，专为需要**视觉刺激**的方言调查、田野调查或儿童语言习得研究设计。

*   **核心逻辑**: 向被试者展示一张图片，并根据文字提示，请他们用方言描述图片内容或说出图中物体的名称，然后录下他们的语音。
*   **强大交互**: 图片浏览器支持**无限缩放**和**自由拖动**，便于观察细节。
*   **沉浸式体验**: 可选择在学习开始时隐藏左侧项目列表，为被试者创造一个更专注、无干扰的采集环境。

### 语料准备与管理
#### Excel 转换器
**路径**: `语料管理 -> Excel 转换器`

**强烈推荐**使用此功能来创建您的词表。它允许不熟悉编程的合作者使用 Excel 来编辑语料，然后一键转换为程序可用的格式。模块内置多种模板，并提供详细的转换报告。

#### 通用词表编辑器
**路径**: `语料管理 -> 词表编辑器`

用于直接编辑**标准词表**（`.py`格式）。支持分组、多语言标注、撤销/重做以及全套快捷键。新增的“自动检测语言”功能可以一键为没有指定语言的词条智能填充语言选项。

#### 图文词表编辑器
**路径**: `方言研究 -> 图文词表编辑`

为“方言图文采集”和“速记卡”功能配套的编辑器。

*   **ID唯一性检查:** 编辑器会自动检测并用**红色高亮**显示任何重复的ID，确保数据完整性。
*   **智能检测**: 核心功能！在填入“项目ID”后，点击“自动检测图片”并勾选“智能检测”，它会模糊匹配并自动填充最相似的图片文件名，极大提高效率。
*   **文件选择器**: 双击“图片文件”单元格，可以直接弹出文件管理器让您选择图片。

#### 数据管理器
**路径**: `语料管理 -> 数据管理器`

一个集**浏览、试听、管理、编辑**于一体的轻量级音频工作站。

*   **统一视图**: 集中管理来自“口音采集”、“语音包录制”、“TTS工具”等所有来源的音频数据。
*   **波形预览与编辑**: 当您选中单个音频文件时，播放器下方会立即渲染出该文件的**波形图**。您可以：
    *   在波形图上**标记起点和终点**来定义一个裁切范围。
    *   **预览**您标记的片段。
    *   将裁切后的音频**另存为**一个新文件，原文件保持不变。
    *   **多选**文件后，通过右键菜单将它们**连接**成一个新文件。
*   **交互优化**: 支持双击文件夹直接在系统浏览器中打开，按Enter键播放选中音频等快捷操作。

#### 音频分析
**路径**: `资源管理 -> 音频分析`

一个轻量级的声学分析工作台，作为 **Praat** 的快速替代或补充，专为最高频的分析任务而设计。

*   **拖拽即分析**: 将任何音频文件（`.wav`, `.mp3`等）从您的电脑直接拖入界面，即可立即加载并显示波形和语谱图。
*   **专业级可视化**:
    *   **语谱图 (Spectrogram)**: 清晰展示声音的频谱随时间变化的情况。
    *   **基频 (F0)**: 自动计算并叠加显示 F0 曲线。最关键的是，F0 曲线拥有**独立的动态Y轴**，其变化趋势能像在 Praat 中一样被清晰地观察，彻底解决了被压缩在底部的视觉问题。
    *   **强度 (Intensity)**: 在图表底部同步显示音频的强度（音量）曲线。
    *   **共振峰 (Formants)**: 支持对可见区域进行快速共振峰分析，或在语谱图上**单击任意位置**进行瞬时的单点共振峰分析。
*   **交互式探索**:
    *   使用 `Ctrl + 鼠标滚轮` 可对波形和语谱图进行**无限、流畅的水平缩放**。
    *   使用底部的**滚动条**可在放大的视图中平移，查看音频的任何细节。
*   **主题化**: 所有分析曲线、背景、文字的颜色都由您当前选择的主题控制，提供最佳的视觉一致性。

#### 日志查看器
**路径**: `语料管理 -> 日志查看器`

本软件的数据洞察与溯源中心，拥有两种强大的工作模式。

*   **会话日志模式**: 审查和追溯所有数据**采集过程**的详细记录。支持对日志内容进行**关键词筛选**，并可将结果导出为Excel。
*   **速记卡进度模式**: 分析和评估所有**学习行为**的量化结果。它会以表格形式清晰展示每个词条的掌握状态、学习次数、错误次数和下一次建议复习日期，为调整学习策略提供数据支持。

### 实用工具
#### 拼音转IPA
**路径**: `实用工具 -> 拼音转IPA`

一个为汉语语言学研究者设计的强大工具，能够将输入的汉字文本实时、准确地转换为国际音标 (IPA)。

*   **多方案支持**: 内置“标准”、“严式”、“宽式”等多种IPA转写方案。
*   **智能音变**: 可一键开启对普通话中“一”、“不”、连续上声等复杂音变规则的自动处理，并在结果中用红色高亮显示变调。

#### TTS 工具
**路径**: `实用工具 -> TTS 工具`

一个功能强大且灵活的批量语音合成工具。

*   **灵活输入**: 支持从标准或图文词表文件批量加载文本，也支持在内置编辑器中即时编辑。
*   **无缝集成**: 核心功能！勾选“**输出到速记卡模块**”后，TTS任务的输出目标会自动切换到速记卡专用音频目录，并以词条ID命名文件，实现对速记卡的一键配音。
*   **后台任务**: 所有转换都在后台进行，配有实时进度条和日志，并可随时中止。

#### 速记卡**路径**: `实用工具 -> 速记卡`

一个深度集成了**主动回忆**和**间隔重复**科学记忆原理的智能化学习系统。

*   **学习与自检分离**:
    *   **学习模式**: 用户可以自由浏览卡片正反面，主动跟读和记忆。
    *   **自检模式**: 程序会隐藏答案，要求用户在输入框中作答。提交后，系统会根据答案的相似度给出精准、分级的反馈。
*   **智能随机顺序**: 这是推荐的默认模式。它基于艾宾浩斯遗忘曲线原理，通过一个**加权优先级排序算法**，优先展示您**不熟悉、经常答错、或很久没复习**的词条，并智能安排已掌握词条的复习周期。
*   **进度管理**: 您所有的学习行为都会被自动记录在 `flashcards/progress/` 目录下的进度文件中。

### 系统与帮助

#### 程序设置
**路径**: `系统与帮助 -> 程序设置`

在这里，您可以对程序的各方面进行个性化配置，包括UI主题、默认路径、音频参数（WAV/MP3）、TTS语言、以及侧边栏宽度等。所有设置都会自动保存。

#### 帮助文档
**路径**: `系统与帮助 -> 帮助文档`

即您正在阅读的这份文档。它采用动态主题适配，外观会随着您在设置中选择的主题而改变，以保证最佳的阅读体验。

---

## 三、高级定制：主题与图标

PhonAcq 引入了一套强大的视觉定制系统，允许用户深度个性化他们的工作环境。

*   **QSS驱动**: 程序的所有外观都由 QSS (Qt Style Sheets) 文件控制。所有主题文件都存放在根目录下的 `themes/` 文件夹中。
*   **自定义图标系统**: 程序采用了一套智能的**分层回退**加载逻辑。当您应用一个包含 `icons/` 子文件夹的“主题包”时，程序会优先加载您的自定义图标；如果找不到，则会自动回退使用 `assets/icons/` 目录下的默认图标。
*   **创建主题包**:
    1.  在 `themes/` 目录下，创建一个以您的主题命名的文件夹（如 `My_Theme/`）。
    2.  在该文件夹内，创建一个同名的QSS文件 (`My_Theme.qss`) 和一个 `icons/` 子文件夹。
    3.  将您的自定义图标放入 `icons/` 文件夹。
    4.  在您的 `.qss` 文件顶部添加注释：`/* @icon-path: "icons/" */`。
    5.  重启程序，您的新主题即可在设置中选择和应用。

---

## 四、常见问题 (FAQ)

**问：为什么双击程序没反应，或者一闪而过？**

答：这通常是由于您的系统缺少必要的运行库，或者被安全软件（如Windows Defender）误拦截。请尝试将PhonAcq Assistant的整个文件夹添加到安全软件的“排除项”或“信任列表”中。

**问：为什么提示“依赖库缺失”？**

答：请根据提示运行 `pip install ...` 命令来安装所有必需的Python库。特别是新功能可能需要 `thefuzz`、`python-Levenshtein`（用于智能检测与自检）以及 `markdown`（用于显示本帮助文档）。使用项目根目录下的 `requirements.txt` 文件 (`pip install -r requirements.txt`) 是最可靠的方法。

**问：在线TTS生成很慢或失败怎么办？**

答：最佳解决方案是使用“**语音包录制**”模块，为您常用的词表录制一套真人提示音。一旦程序找到了本地的真人录音，它将不再需要进行在线TTS生成。

**问. 录音音量太小或太大（有破音）怎么办？**

答：请前往 `系统与帮助 -> 程序设置 -> 音频与录音`，调整“**录音音量增益**”滑块。同时，也请检查您操作系统的麦克风输入音量。

**问：为什么在“数据管理器”里，多选文件时波形图和编辑工具会变灰？**

答：这是有意为之的设计。裁切、标记等编辑功能是针对**单个**音频文件的精细操作。当您选中多个文件时，程序会暂时禁用这些工具以防误操作。多选的主要目的是为了进行“连接选中音频”或批量删除等操作。

**问：如何备份我的所有数据和设置？**

答：PhonAcq Assistant是“绿色便携”的。您只需要将**整个PhonAcq Assistant的根文件夹**完整地复制到安全的位置（如U盘、云盘），即可完成对所有词表、录音、学习进度和个人设置的完整备份。

---

## 五、关于与致谢
**PhonAcq Assistant** 的开发旨在为语言学研究社区提供一个现代化、开源、易用的工具，以促进学术研究的效率和数据的规范性。

感谢所有为此项目提供建议和反馈的用户！